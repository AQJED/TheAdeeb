<style>
    /* --- DIAGRAM CONTAINER --- */
    .latency-diag-container {
        margin: 40px 0;
        padding: 25px; /* Slightly reduced padding */
        background-color: #162032;
        border-radius: 8px;
        border: 1px solid #334155;
        overflow-x: auto; /* Safety net: prevents spilling on small windows */
    }

    /* --- PIPELINE FLOW --- */
    .diag-flow {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 5px;
        margin-bottom: 30px;
        min-width: 650px; /* Ensures the diagram doesn't squash too much before mobile-view kicks in */
    }

    .diag-node {
        background-color: var(--card-bg);
        border: 1px solid #334155;
        padding: 12px 10px;
        border-radius: 4px;
        flex: 0 1 120px; /* More flexible width */
        min-width: 100px;
        text-align: center;
        display: flex;
        flex-direction: column;
    }

    .diag-node.middleware {
        border: 1px solid var(--accent);
        box-shadow: 0 0 10px rgba(16, 185, 129, 0.1);
    }

    .diag-node.result {
        border-style: dashed;
        background-color: transparent;
    }

    .node-label {
        font-family: var(--font-mono);
        color: #e2e8f0 !important;
        font-weight: bold;
        font-size: 0.85rem;
    }

    .middleware .node-label {
        color: var(--accent) !important;
    }

    .node-sub {
        font-size: 0.7rem;
        color: #94a3b8 !important;
        margin-top: 4px;
    }

    .diag-connector {
        display: flex;
        flex-direction: column;
        align-items: center;
        flex: 1 1 40px; /* Allows connectors to shrink first */
        min-width: 30px;
    }

    .conn-text {
        font-family: var(--font-mono);
        font-size: 0.65rem;
        color: #94a3b8 !important;
        text-align: center;
        line-height: 1.1;
        margin-bottom: 5px;
        white-space: nowrap;
    }

    .conn-arrow {
        color: #475569 !important;
        font-size: 1rem;
    }

    /* --- DATA AGE BAR --- */
    .data-age-bar {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #334155;
    }

    .age-label {
        font-family: var(--font-mono);
        font-size: 0.8rem;
        color: var(--accent) !important;
        margin-bottom: 8px;
        letter-spacing: 1px;
    }

    .age-line {
        height: 8px;
        background: #334155;
        border-radius: 4px;
        position: relative;
        display: flex;
        align-items: center;
    }

    .age-fill {
        width: 95%;
        height: 100%;
        background: linear-gradient(90deg, transparent, var(--accent));
        border-radius: 4px;
    }

    .age-arrow {
        color: var(--accent) !important;
        margin-left: -5px;
        font-size: 0.8rem;
    }

    .age-caption {
        font-size: 0.75rem;
        color: #94a3b8 !important;
        margin-top: 8px;
        text-align: right;
        font-style: italic;
    }

    .diag-caption {
        margin-top: 20px;
        font-size: 0.85rem;
        color: #94a3b8 !important;
        line-height: 1.5;
    }

    /* --- MOBILE RESPONSIVENESS --- */
    @media (max-width: 768px) {
        .diag-flow { 
            flex-direction: column; 
            min-width: auto; 
        }
        .diag-node { width: 100%; flex: 1 1 auto; }
        .diag-connector { padding: 10px 0; }
        .conn-arrow { transform: rotate(90deg); }
    }
</style>

<figure class="latency-diag-container" role="group" aria-label="End-to-end latency and data age pipeline">
    <div class="diag-flow">
        <div class="diag-node">
            <span class="node-label">Black Box</span>
            <span class="node-sub">Event Happens</span>
        </div>
        <div class="diag-connector">
            <span class="conn-text">Sampling +<br>Network</span>
            <span class="conn-arrow">──▶</span>
        </div>
        <div class="diag-node middleware">
            <span class="node-label">Middleware</span>
            <span class="node-sub">Processing</span>
        </div>
        <div class="diag-connector">
            <span class="conn-text">Network<br>Latency</span>
            <span class="conn-arrow">──▶</span>
        </div>
        <div class="diag-node">
            <span class="node-label">Black Box</span>
            <span class="node-sub">Internal logic</span>
        </div>
        <div class="diag-connector">
            <span class="conn-text">Display<br>Latency</span>
            <span class="conn-arrow">──▶</span>
        </div>
        <div class="diag-node result">
            <span class="node-label">Visible Result</span>
        </div>
    </div>
    <div class="data-age-bar">
        <div class="age-label">DATA AGE</div>
        <div class="age-line">
            <div class="age-fill"></div>
            <div class="age-arrow">▶</div>
        </div>
        <div class="age-caption">Grows across the whole chain</div>
    </div>
    <figcaption class="diag-caption">
        End-to-end view. Latency is internal to each stage; Data Age is the cumulative sum of the entire pipeline.
    </figcaption>
</figure>
